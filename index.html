<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
  import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCkIF3WOKAj0dtZanCIpAMrnkL9iZe5Y8o",
    authDomain: "okveto-kupon.firebaseapp.com",
    projectId: "okveto-kupon"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function useCoupon() {
    const code = document.getElementById("codeInput").value;
    const couponRef = doc(db, "coupons", code);
    const couponSnap = await getDoc(couponRef);

    if (!couponSnap.exists()) {
      document.getElementById("result").innerText = "❌ Geçersiz kupon kodu.";
      return;
    }

    const data = couponSnap.data();

    if (data.used === true) {
      document.getElementById("result").innerText = "⚠️ Bu kupon daha önce kullanılmış.";
    } else {
      await updateDoc(couponRef, {
        used: true,
        usedAt: new Date().toISOString()
      });
      document.getElementById("result").innerText = "✅ Kupon başarıyla kullanıldı!";
    }
  }
</script>
